<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat Room</title>
    <script src="/socket.io/socket.io.js"></script>
    <!-- Important -->
  </head>
  <body>
    <h2>Room: <span id="roomName"></span></h2>

    <div
      id="messages"
      style="
        height: 300px;
        overflow-y: scroll;
        background: #eee;
        margin-bottom: 10px;
      "
    ></div>

    <input type="text" id="messageInput" placeholder="Type your message" />
    <button onclick="sendMessage()">Send</button>

    <script>
      const socket = io();
      const roomCode = localStorage.getItem("roomCode");

      if (!roomCode) {
        window.location.href = "index.html";
      }

      document.getElementById("roomName").innerText = roomCode;

      socket.emit("joinRoom", roomCode);

      function sendMessage() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();
        if (message) {
          socket.emit("chatMessage", { room: roomCode, message });
          input.value = "";
        }
      }

      socket.on("chatMessage", (msg) => {
        const div = document.createElement("div");
        div.innerText = msg;
        document.getElementById("messages").appendChild(div);
        document.getElementById("messages").scrollTop =
          document.getElementById("messages").scrollHeight;
      });
    </script>
  </body>
</html>
